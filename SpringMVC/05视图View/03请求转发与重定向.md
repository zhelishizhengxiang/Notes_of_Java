
## 1.回顾转发和重定向区别

1. 转发是一次请求。因此浏览器地址栏上的地址不会发生变化；重定向是两次请求。因此浏览器地址栏上的地址会发生变化。
2. 转发的代码实现：request.getRequestDispatcher("/index").forward(request, response);  重定向的代码实现：response.sendRedirect("/webapproot/index");
3. 转发是服务器内部资源跳转，由服务器来控制。不可实现跨域访问。重定向可以完成内部资源的跳转，也可以完成跨域跳转。
4. 转发的方式可以访问WEB-INF目录下受保护的资源。重定向相当于浏览器重新发送了一次请求，在浏览器直接发送的请求是无法访问WEB-INF目录下受保护的资源的。

转发原理：  
   1. 假设发送了 /a 请求，执行了 AServlet
   2. 在AServlet 中通过`request.getRequestDispatcher("/b").forward(request,response);`转发到BServlet
   3. 从AServlet跳转到BServlet是服务器内部来控制的。对于浏览器而言，浏览器只发送了一个 /a 请求。
   
重定向原理：  
   4. 假设发送了 /a 请求，执行了 AServlet
   5. 在AServlet 中通过`response.sendRedirect("/webapproot/b")`重定向到BServlet
   6. 此时服务器会将请求路径`/webapproot/b`响应给浏览器
   7. 浏览器会自发的再次发送`/webapproot/b`请求来访问BServlet
   8. 因此对于重定向来说，发送了两次请求，一次是 `/webapproot/a`，另一次是`/webapproot/b`。

以上所描述的是使用原生Servlet API来完成转发和重定向。在Spring MVC中是如何转发和重定向的呢？


## 2.Spring MVC实现请求转发
* **在Spring MVC中默认就是转发的方式，我们之前所写的程序，都是转发的方式。只不过都是转发到Thymeleaf的模板文件xxx.html上。底层会直接创建 Thymeleaf 专属的视图对象。
* **在Spring MVC中如何转发到另一个Controller上呢？可以使用Spring MVC的`return "forward:下一个资源的路径"`**

代码实现如下：
```java
package com.powernode.springmvc.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class IndexController {

    @RequestMapping("/a")
    public String toA(){
	    //这个就不是逻辑视图名称了
        return "forward:/b";
    }

    @RequestMapping("/b")
    public String toB(){
        return "b";
    }
}
```
视图页面：
```html
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>b</title>
</head>
<body>
<h1>Page B!!!</h1>
</body>
</html>
```
启动服务器，浏览器地址栏上输入：http://localhost:8080/springmvc/a  
![image.png](https://cdn.nlark.com/yuque/0/2024/png/21376908/1710839187256-3c823090-ff26-4d46-8dca-d7727e800da9.png#averageHue=%23d5b384&clientId=u7eaef306-20e2-4&from=paste&height=168&id=u9c3cee51&originHeight=168&originWidth=403&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10018&status=done&style=shadow&taskId=u306e0e42-2817-4d52-ac2a-8e4045520ea&title=&width=403)

通过测试，可以顺利的完成转发，转发是一次请求，可以看到地址栏上的地址没有发生改变。

我们来跟踪一下源码，看看以上程序执行过程中，创建了几个视图对象，分别是什么？    
![image.png](https://cdn.nlark.com/yuque/0/2024/png/21376908/1710846891647-16906724-4f82-4a5f-9bae-655b3ce869e3.png#averageHue=%23fbf4f2&clientId=u7eaef306-20e2-4&from=paste&height=167&id=ua9ef9d83&originHeight=167&originWidth=1289&originalType=binary&ratio=1&rotation=0&showTitle=false&size=53389&status=done&style=shadow&taskId=u0bea72cc-b0c1-481f-a5e3-954a34be29a&title=&width=1289)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/21376908/1710846943388-ff000327-18e6-4920-96d7-f96e59c62202.png#averageHue=%23cca26b&clientId=u7eaef306-20e2-4&from=paste&height=141&id=u2688da80&originHeight=141&originWidth=642&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29346&status=done&style=shadow&taskId=u4c181cf8-4ef8-44ff-8e3e-dc65c2eb6f0&title=&width=642)

* 通过源码的跟踪得知：整个请求处理过程中，一共创建了两个视图对象
	- InternalResourceView
	- ThymeleafView

这说明转发底层创建的视图对象是：InternalResourceView。
**思考：既然会创建InternalResourceView，应该会对应一个视图解析器呀（InternalResourceViewResolver）？但是我在springmvc.xml文件中只配置了ThymeleafViewResolver，并没有配置InternalResourceViewResolver呀？这是为什么？**
**这是因为**`**forward:**`** 后面的不是**`**逻辑视图名**`**，而是一个**`**请求路径**`**。因此转发是不需要视图解析器的。**
**另外，转发使用的是InternalResourceView，也说明了转发是内部资源的跳转。（Internal是内部的意思，Resource是资源的意思。）**


## 3.Spring MVC实现重定向
* r**edirect是专门完成重定向效果的。和forward语法类似，只需要将之前的 `return "forward:/b"`修改为 `return "redirect:/b"`即可**。
* **相较于请求转发，重定向使用较多**
```java
package com.powernode.springmvc.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class IndexController {

    @RequestMapping("/a")
    public String toA(){
        return "redirect:/b";
    }

    @RequestMapping("/b")
    public String toB(){
        return "b";
    }
}

```
视图页面：
```html
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>b</title>
</head>
<body>
<h1>Page B!!!</h1>
</body>
</html>
```
启动服务器，浏览器地址栏上输入：http://localhost:8080/springmvc/a  
![image.png](https://cdn.nlark.com/yuque/0/2024/png/21376908/1710857817456-baf96179-4ce2-4897-8873-aa1232ed8462.png#averageHue=%23f6f6f5&clientId=u7eaef306-20e2-4&from=paste&height=133&id=u2487522b&originHeight=133&originWidth=426&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7738&status=done&style=shadow&taskId=ub70b70d6-40c5-4379-abdf-9236c65bf63&title=&width=426)

可见，重定向是两次请求，地址栏上的地址发生了改变。

可以看一下源码，在重定向的时候，Spring MVC创建哪个视图对象？  
![image.png](https://cdn.nlark.com/yuque/0/2024/png/21376908/1710857964522-8ccd525e-e458-41e2-abc8-6336a46bc17c.png#averageHue=%23d5b68e&clientId=u7eaef306-20e2-4&from=paste&height=133&id=u67e2c7f3&originHeight=133&originWidth=999&originalType=binary&ratio=1&rotation=0&showTitle=false&size=35125&status=done&style=shadow&taskId=u3c450b56-5899-47ae-b2e8-f46dc146043&title=&width=999)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/21376908/1710858016866-c2e30ccf-0b94-494d-9b89-0853fb2fa7af.png#averageHue=%23cca369&clientId=u7eaef306-20e2-4&from=paste&height=122&id=u75288812&originHeight=122&originWidth=610&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24109&status=done&style=shadow&taskId=uef0f52d9-05fa-4734-befa-3f1240df464&title=&width=610)
* 通过断点调试可以看出，**当重定向的时候，SpringMVC会创建一个重定向视图对象：**RedirectView**。这个视图对象也是SpringMVC框架内置的**。
* 另外可以看出重定向之后的第二次请求创建的视图对象就是ThymeleafView了。



注意：从springmvc应用重定向到springmvc2应用（跨域），语法是：
```java
@RequestMapping("/a")
public String a(){
    return "redirect:http://localhost:8080/springmvc2/b";
}
```
可以自行测试一下！！！


注：转发和重定向的底层源码如下图所示    
![](assets/03请求转发与重定向/file-20250805174146441.png)
![](assets/03请求转发与重定向/file-20250805175404981.png)